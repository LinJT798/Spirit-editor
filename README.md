# 精灵表切割与动画预览工具集

一个功能完整的精灵表处理工具集，包含精灵表切割工具和帧动画预览工具，提供从切割到动画制作的完整工作流。

## 功能特点

### 切割模式
1. **按尺寸网格切割** - 指定单元格的像素尺寸进行切割
2. **按数量网格切割** - 指定行列数量均分图片
3. **自动检测切割** - 自动识别精灵边界，智能分离独立精灵
4. **手动框选切割** - 手动框选需要的精灵区域

### 精灵选择功能
- **交互式选择**：点击画布上的精灵进行选择/取消选择
- **批量操作**：全选、取消全选、反选功能
- **视觉反馈**：选中精灵显示红色边框，未选中显示蓝色边框
- **实时统计**：显示已选择精灵数量

### 导出功能
- **单图导出**：每个精灵导出为独立文件
- **图集导出**：将选中精灵重新打包为优化的图集
- **灵活配置**：支持多种导出格式和参数设置
- **智能排列**：多种图集打包算法优化空间利用
- **元数据生成**：自动生成JSON配置文件记录精灵信息

### 其他功能
- 实时预览切割效果
- 支持去除透明边缘
- 图片缩放查看（0.1x - 3.0x）
- 鼠标滚轮滚动支持
- 支持多种图片格式（PNG、JPG、GIF、BMP、WebP）

## 安装

### 依赖要求
- Python 3.7+
- Pillow (图像处理)
- OpenCV (图像分析)
- NumPy (数组操作)
- Tkinter (GUI界面，Python自带)

### 安装步骤

1. 克隆或下载项目
2. 运行安装脚本（会自动创建虚拟环境并安装依赖）：
```bash
chmod +x setup.sh run.sh  # 添加执行权限（首次需要）
./setup.sh                 # 运行安装脚本
```

或手动创建虚拟环境：
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate   # Mac/Linux
# 或
venv\Scripts\activate      # Windows

# 安装依赖
pip install -r requirements.txt
```

## 使用方法

### 工具一：精灵表切割工具

#### 启动程序

##### 方法一：使用启动脚本（推荐）
```bash
./run.sh   # 自动激活虚拟环境并运行
```

##### 方法二：手动启动
```bash
# 1. 激活虚拟环境
source venv/bin/activate   # Mac/Linux
# 或
venv\Scripts\activate      # Windows

# 2. 运行程序
python main.py

# 3. 退出虚拟环境（使用完后）
deactivate
```

#### 操作流程

1. **加载图片**
   - 点击"选择图片"按钮或使用菜单"文件 > 打开图片"
   - 选择要切割的精灵表图片

2. **选择切割模式**
   - **按尺寸网格切割**：设置单元格宽高、间距和偏移
   - **按数量网格切割**：设置行列数和间距
   - **自动检测切割**：设置最小精灵尺寸和透明度阈值
   - **手动框选切割**：在图片上拖动鼠标框选精灵

3. **执行切割**
   - 点击"执行切割"按钮
   - 查看切割预览（蓝色边框）

4. **选择精灵**
   - 点击画布上的精灵进行选择/取消选择（选中显示红色边框）
   - 使用"全选"、"取消全选"、"反选"按钮批量操作
   - 实时显示选中精灵数量

5. **导出精灵**
   - 选择导出模式（单图导出/图集导出）
   - 配置导出参数
   - 点击"导出选中精灵"按钮
   - 选择导出目录

### 导出模式

#### 单图导出
- 每个选中的精灵导出为独立文件
- 参数配置：
  - **命名前缀**：精灵文件名前缀
  - **导出格式**：PNG/JPG/WebP
  - **去除透明边缘**：自动裁剪透明区域

#### 图集导出
- 将选中的精灵重新打包成一张图集
- 参数配置：
  - **精灵间距**：精灵之间的像素间隔（默认2像素）
  - **最大宽度**：图集最大宽度限制（默认2048像素）
  - **排列方式**：
    - row：按行排列
    - square：尽量保持方形
    - tight：紧凑排列
  - **图集名称**：输出的图集文件名
  - **导出格式**：PNG/JPG/WebP
  - **去除透明边缘**：处理每个精灵的透明区域

### 导出内容

#### 单图导出模式
- 独立的精灵图片文件
- sprites_metadata.json配置文件

#### 图集导出模式
- atlas.png（或其他格式）：合并后的图集文件
- atlas.json配置文件，包含：
  - 图集尺寸信息
  - 每个精灵在图集中的位置和尺寸
  - 精灵名称映射

## 参数说明

### 网格切割参数
- **单元格宽/高度**：每个精灵的像素尺寸
- **水平/垂直间距**：精灵之间的间隔像素
- **X/Y偏移**：从图片左上角的起始偏移

### 自动切割参数
- **最小精灵尺寸**：忽略小于此尺寸的区域
- **透明度阈值**：Alpha通道低于此值视为透明

## 文件结构
```
精灵表切割/
├── main.py              # 主程序入口
├── sprite_cutter.py     # 核心切割逻辑
├── gui.py              # GUI界面
├── animation_preview.py # 帧动画预览工具
├── requirements.txt    # 依赖包列表
├── run.sh              # 精灵切割工具启动脚本
├── preview.sh          # 动画预览工具启动脚本
├── setup.sh            # 环境安装脚本
└── README.md          # 说明文档
```

### 工具二：帧动画预览工具

#### 启动程序
```bash
./preview.sh   # 自动激活虚拟环境并运行
```

#### 功能特性
- **图集加载**：自动扫描output文件夹中的图集
- **帧选择**：点击选择单帧，Ctrl+点击多选
- **动画预览**：实时播放选中帧，可调节帧率（1-60 FPS）
- **动作编组**：为帧序列创建命名动作组
- **配置导出**：生成游戏引擎可用的动画配置JSON

#### 操作流程

1. **加载图集**
   - 从左侧列表选择已导出的图集
   - 图集会显示在中央区域，带有网格和索引

2. **选择帧**
   - 单击选择单个帧（红色边框）
   - Ctrl+点击添加或移除选择
   - 选中的帧可用于预览或创建动作

3. **预览动画**
   - 选择帧后点击"播放"按钮
   - 调节FPS滑块改变播放速度
   - 使用"重置"按钮停止播放

4. **创建动作组**
   - 选择一组帧
   - 输入动作名称（如"walk"、"jump"）
   - 点击"添加动作"保存
   - 可创建多个动作组

5. **导出配置**
   - 完成所有动作组后
   - 点击"导出动画配置"
   - JSON文件保存在图集文件夹中

#### 导出的动画配置格式
```json
{
  "sprite_info": {
    "name": "character",    // 精灵名称
    "width": 32,            // 精灵宽度
    "height": 32            // 精灵高度
  },
  "layout": {
    "columns": 8,           // 图集列数
    "rows": 4,             // 图集行数
    "padding": 2           // 精灵间距
  },
  "actions": {
    "idle": {              // 动作名称
      "frames": [[0,0], [0,1], [0,2]],  // 帧坐标[行,列]
      "frame_count": 3     // 帧数
    },
    "walk": {
      "frames": [[1,0], [1,1], [1,2], [1,3]],
      "frame_count": 4
    }
  },
  "frame_rate": 12         // 默认帧率
}
```

## 工作流程示例

1. **准备精灵表** → 使用精灵表切割工具
2. **切割并导出图集** → 自动保存到output文件夹
3. **打开动画预览工具** → 加载导出的图集
4. **创建动作组** → 选择帧并命名动作
5. **导出动画配置** → 生成可用于游戏引擎的JSON

## 注意事项
- **必须在虚拟环境中运行**，避免与系统Python包冲突
- 建议使用PNG格式的精灵表以保留透明通道
- 自动切割适合精灵之间有明显间隔的图片
- 手动切割适合不规则排列的精灵表
- 导出前可预览切割效果，避免重复操作
- macOS用户如遇到权限问题，请使用 `chmod +x setup.sh run.sh preview.sh` 添加执行权限
- 动画预览工具依赖于精灵表切割工具的导出格式

## 许可证
MIT License